pipeline 
{
    agent any
    tools {
        terraform 'terraform'
          }

    stages {
       
        stage('Git Checkout') 
        {
            steps {
                
                git credentialsId: 'github-private-key', url: 'https://github.com/paayi-tech/jenkins-third/'

                  }
        }
       
        stage('Terraform Init') 
        {
            steps {

                sh 'terraform init'

                  }
        }

        stage('Terraform Plan') 
        {
            steps {

                withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'jenkins', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']])
                
                {
               
                 sh 'terraform plan'
                }
               
                  }
        }
        stage('Terraform Apply') 
        {
            steps {
                   withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'jenkins', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) 

                   {
                
                 sh 'terraform apply --auto-approve'

                   }
                
                
                   }
        }
        

    }
}